# Script

You can automate your processes, such as executing HTTP requests using loops and conditions.

E.g., retrieve JSON from APIs, modify it using `Vason query system`, and transmit it to the cloud.

The automation script is just simple javascript program, which you are writing by yourself.

You can debug your script by placing the "debugger" keyword somethere in the script, and opening a browser's development tool.

## Vason API

Additionally, there are non-blocking Vason API functions available for sequential execution mode, ensuring operation without blocking the GUI:

### Service functions and variables

- <span style={{color: '#26bbae'}}>VARS</span>.<span style={{color: '#f9a156'}}>&lt;variable name&gt;</span> - set global variable, see the tab "HTTP variables"
- <span style={{color: '#26bbae'}}>CONSOLE</span> (<span style={{color: '#f9a156'}}>&lt;text or JSON&gt;</span>) - print text or JSON on console box
- <span style={{color: '#26bbae'}}>ERROR</span> (<span style={{color: '#f9a156'}}>&lt;error message&gt;</span>) - print error message on console box
- <span style={{color: '#26bbae'}}>SLEEP</span> (<span style={{color: '#f9a156'}}>&lt;milliseconds, e.g. 2000 - 2 sec&gt;</span>) - pause script

### HTTP Request functions

- <details>
        <summary>
            <span style={{color: '#26bbae'}}>REQ</span> (<span style={{color: '#f9a156'}}>&lt;request description&gt;</span>,
            optional: <span style={{color: '#f9a156'}}>&lt;request body: string&gt;</span>) - send HTTP request, see the tab "HTTP requests"
        </summary>
        - 1st parameter - request description after "###"
        - 2nd parameter - request body only for POST/PUT requests
    </details>
- <details>
        <summary>
            <span style={{color: '#26bbae'}}>BEFORE_REQ</span> (<span style={{color: '#f9a156'}}>&lt;request description&gt;</span>,
                <span style={{color: '#f9a156'}}>&lt;function(requestObject) &#123; ... &#125;&gt;</span>) -
                register a request's BEFORE-hook, i.e. a function that can be executed before a request (see the tab "HTTP requests")
        </summary>
        - 1st parameter - the request description after "###"
        - 2nd parameter - a callback function that will be executed before the request and will also be triggered when executing the request from the "HTTP requests" tab.
            The callback function should have only one parameter, the request object with the properties:
                - url - the request url
                - method - the request method (GET, POST, PUT, DELETE)
                - headers - the request headers object in the format: &lt;http header name&gt;: &lt;http header value&gt;. This parameter can be empty object.
                - body - the request body. This parameter can be empty/null/undefined.
                - description - the request description after "###"
                    You can set the "sendBodyAsBytes" property to "true" in a request object to send its body as a byte array
                    It is not possible to use variables defined in the script root inside the "BEFORE_REQ" callback function definition
    </details>
- <details>
        <summary>
            <span style={{color: '#26bbae'}}>AFTER_REQ</span> (<span style={{color: '#f9a156'}}>&lt;request description&gt;</span>,
            <span style={{color: '#f9a156'}}>&lt;function(responseData, responseObject, requestObject) &#123; ... &#125;&gt;</span>) -
            register a request's AFTER-hook, i.e. a function that can be executed after a request (see the tab "HTTP requests")
        </summary>
        - 1st parameter - the request description after "###"
        - 2nd parameter - a function that will be executed after the request and will also be triggered when executing the request from the "HTTP requests" tab.
            The callback function should have the 3 parameters:
                - the response data: JSON, plain text or undefined
                - the response object with the fields:
                    - status - the response status
                    - statusText - the response status text
                    - reason - the response reason
                    - responseJSON - the response JSON
                    - responseText - the response text
                - the request object with the fields:
                    - url - the request url
                    - method - the request method (GET, POST, PUT, DELETE)
                    - headers - the request headers object in the format:
                        <span style={{color: '#f9a156'}}>&lt;http header name&gt;</span>:
                        <span style={{color: '#f9a156'}}>&lt;http header value&gt;</span>.
                        This parameter can be empty object.
                    - body - the request body. This parameter can be empty/null/undefined.
                    - description - the request description after "###"
            It is not possible to use variables defined in the script root inside "AFTER_REQ" callback function definition
    </details>

### Query system functions

- <details>
        <summary>
            <span style={{color: '#26bbae'}}>QUERY</span> (<span style={{color: '#f9a156'}}>&lt;json&gt;</span>,
            <span style={{color: '#f9a156'}}>&lt;query string&gt;</span>) - select/find value from json, or make the new json based on JSON parameter
        </summary>
        - 1st parameter - json or variable with json to query
        - 2nd parameter - query string in jsonata format, see JSONata documentation
            by using QUERY one can change one or more particular properties in original json
    </details>

### Convert functions: string to string

|<span style={{color: '#f9a156'}}>parameter(P)</span>/return|JSON string|XML string|YAML string|TOML string|
|-|-|-|-|-|
|<span style={{color: '#f9a156'}}>&lt;JSON string&gt;</span>||<span style={{color: '#26bbae'}}>JSON_TO_XML</span>(<span style={{color: '#f9a156'}}>P</span>)|<span style={{color: '#26bbae'}}>JSON_TO_YAML</span>(<span style={{color: '#f9a156'}}>P</span>)|<span style={{color: '#26bbae'}}>JSON_TO_TOML</span>(<span style={{color: '#f9a156'}}>P</span>)|
|<span style={{color: '#f9a156'}}>&lt;XML string&gt;</span>|<span style={{color: '#26bbae'}}>XML_TO_JSON</span>(<span style={{color: '#f9a156'}}>P</span>)||<span style={{color: '#26bbae'}}>XML_TO_YAML</span>(<span style={{color: '#f9a156'}}>P</span>)|<span style={{color: '#26bbae'}}>XML_TO_TOML</span>(<span style={{color: '#f9a156'}}>P</span>)|
|<span style={{color: '#f9a156'}}>&lt;YAML string&gt;</span>|<span style={{color: '#26bbae'}}>YAML_TO_JSON</span>(<span style={{color: '#f9a156'}}>P</span>)|<span style={{color: '#26bbae'}}>YAML_TO_XML</span>(<span style={{color: '#f9a156'}}>P</span>)||<span style={{color: '#26bbae'}}>YAML_TO_TOML</span>(<span style={{color: '#f9a156'}}>P</span>)|
|<span style={{color: '#f9a156'}}>&lt;TOML string&gt;</span>|<span style={{color: '#26bbae'}}>TOML_TO_JSON</span>(<span style={{color: '#f9a156'}}>P</span>)|<span style={{color: '#26bbae'}}>TOML_TO_XML</span>(<span style={{color: '#f9a156'}}>P</span>)|<span style={{color: '#26bbae'}}>TOML_TO_YAML</span>(<span style={{color: '#f9a156'}}>P</span>)||


|<span style={{color: '#f9a156'}}>parameter(P)</span>/return|BASE64 encoded string|any format string|
|-|-|-|
|<span style={{color: '#f9a156'}}>&lt;BASE64 encoded string&gt;</span>||<span style={{color: '#26bbae'}}>BASE64_TO_STRING</span>(<span style={{color: '#f9a156'}}>P</span>)|
|<span style={{color: '#f9a156'}}>&lt;any format string&gt;</span>|<span style={{color: '#26bbae'}}>STRING_TO_BASE64</span>(<span style={{color: '#f9a156'}}>P</span>)||

### Convert functions: extra

|<span style={{color: '#f9a156'}}>Source</span>/Destination|String|Left Editor|Right Editor|
|-|-|-|-|
|<span style={{color: '#f9a156'}}>String</span>||<span style={{color: '#26bbae'}}>STRING_TO_LEFT_EDITOR</span>(<span style={{color: '#f9a156'}}>P</span>)|<span style={{color: '#26bbae'}}>STRING_TO_RIGHT_EDITOR</span>(<span style={{color: '#f9a156'}}>P</span>)|
|<span style={{color: '#f9a156'}}>Left Editor</span>|<span style={{color: '#26bbae'}}>LEFT_EDITOR_TO_STRING</span>()||
|<span style={{color: '#f9a156'}}>Right Editor</span>|<span style={{color: '#26bbae'}}>RIGHT_EDITOR_TO_STRING</span>()||


|<span style={{color: '#f9a156'}}>parameter(P)</span>/return|string|JSON-object|XML-document|
|-|-|-|-|
|<span style={{color: '#f9a156'}}>string</span>||<span style={{color: '#26bbae'}}>PARSE_JSON</span>(<span style={{color: '#f9a156'}}>P</span>)|<span style={{color: '#26bbae'}}>PARSE_XML</span>(<span style={{color: '#f9a156'}}>P</span>)|
|<span style={{color: '#f9a156'}}>JSON-object</span>|<span style={{color: '#26bbae'}}>STRINGIFY_JSON</span>(<span style={{color: '#f9a156'}}>P</span>)|||
|<span style={{color: '#f9a156'}}>XML-document</span>|<span style={{color: '#26bbae'}}>STRINGIFY_XML</span>(<span style={{color: '#f9a156'}}>P</span>)|||


## Exaple script

```js

// There are non-blocking Vason API functions
// available for sequential execution mode,
// ensuring operation without blocking the GUI
// Click help button to see the complete documentation
// debugger // to debug your script place the "debugger"
// keyword somethere and open a browser's development tool

/* -------------- example: request hooks -------------- */
function exampleBeforeHook(requestObject) {
    CONSOLE('Start request: ' + requestObject.description)
}

BEFORE_REQ('example receive access token', exampleBeforeHook)

AFTER_REQ('example receive access token', (responseData, responseObject, requestObject) => {
    CONSOLE('End request: ' + requestObject.description)
    VARS.token = responseData.token
    // you can also store a cookie this way
    // document.cookie = "token=" + data.token  + "; path=/"
})

/* -------------- example: request and assign response to global variable -------------- */
// the variable can be assigne also in AFTER hook
VARS.token = REQ('example receive access token').token

// pause 1 sec
SLEEP(1000)

// write to Vason console
CONSOLE('authorization token received: ' + VARS.token)

/* -------------- example: request and loop -------------- */
for (let planet of REQ('example get planets').planets) {
    /* -------------- example: query to make the new json -------------- */
    /* by using QUERY one can change one or more paticular properties in original json */
    var newPlanet = QUERY(planet, '$~>|**.extra|{"distance": $number(distance) * 1000000}|')
    CONSOLE('update distance for planet: ' + newPlanet.name)
    SLEEP(1000)

    /* -------------- example: rquest with new body -------------- */
    var newDistance = REQ('example update planet', newPlanet).updatedObject.extra.distance
    CONSOLE('new distance: ' + newDistance)
}

```

## User interface

import ThemedImage from '@theme/ThemedImage';

<ThemedImage
    alt="Script"
    sources={{
        light: '/img/Script_light.png',
        dark: '/img/Script_dark.png',
    }}
/>

1. Console box
2. Script editor
3. Click to execute script
4. Click to interrupt script

## Debug

<ThemedImage
    alt="Debug"
    sources={{
        light: '/img/Debug_light.png',
        dark: '/img/Debug_dark.png',
    }}
/>

1. Write `debug` in script and open `Developer tools` (Ctrl+Shift+I)
2. Click `Execute script` to start script
3. Analyse script in debug mode